- name: Setup Homelab
  hosts: homelab
  roles:
    - role: install_common
    - role: install_packer
  tags:
    - install

- name: Start VMs
  hosts: homelab
  roles:
    - role: create_vm
      vm_name: control-plane-1
      vcpus: 2
    - role: create_vm
      vm_name: worker-1
  tags:
    - create

- name: Destroy all VMs
  hosts: homelab
  roles:
    - role: destroy_vms
  tags:
    - never
    - destroy

- name: Install Kubernetes
  hosts: vms
  roles:
    - role: install_kubernetes
  tags:
    - never
    - k8s
